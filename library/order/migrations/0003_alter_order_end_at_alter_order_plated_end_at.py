# Generated by Django 4.1 on 2025-03-25 22:59

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('order', '0001_initial'),
    ]

    operations = [
        migrations.RunSQL(
            sql="""
                DO $$
                BEGIN
                    IF EXISTS (
                        SELECT 1
                        FROM information_schema.columns
                        WHERE table_name='order_order'
                          AND column_name='end_at'
                          AND data_type = 'integer'
                    ) THEN
                        EXECUTE 'ALTER TABLE order_order ALTER COLUMN end_at TYPE timestamp with time zone USING to_timestamp(end_at::double precision)';
                    END IF;
                END $$;

                DO $$
                BEGIN
                    IF EXISTS (
                        SELECT 1
                        FROM information_schema.columns
                        WHERE table_name='order_order'
                          AND column_name='plated_end_at'
                          AND data_type = 'integer'
                    ) THEN
                        EXECUTE 'ALTER TABLE order_order ALTER COLUMN plated_end_at TYPE timestamp with time zone USING to_timestamp(plated_end_at::double precision)';
                    END IF;
                END $$;
            """,
        reverse_sql="""
                DO $$
                BEGIN
                    IF EXISTS (
                        SELECT 1
                        FROM information_schema.columns
                        WHERE table_name='order_order'
                          AND column_name='end_at'
                          AND data_type = 'timestamp with time zone'
                    ) THEN
                        EXECUTE 'ALTER TABLE order_order ALTER COLUMN end_at TYPE integer USING extract(epoch from end_at)::integer';
                    END IF;
                END $$;

                DO $$
                BEGIN
                    IF EXISTS (
                        SELECT 1
                        FROM information_schema.columns
                        WHERE table_name='order_order'
                          AND column_name='plated_end_at'
                          AND data_type = 'timestamp with time zone'
                    ) THEN
                        EXECUTE 'ALTER TABLE order_order ALTER COLUMN plated_end_at TYPE integer USING extract(epoch from plated_end_at)::integer';
                    END IF;
                END $$;

            """,
        ),
    # migrations.RunSQL(
    #     sql="""
    #         ALTER TABLE order_order
    #         ALTER COLUMN end_at TYPE timestamp with time zone USING to_timestamp(end_at::double precision);
    #         ALTER TABLE order_order
    #         ALTER COLUMN plated_end_at TYPE timestamp with time zone USING to_timestamp(plated_end_at::double precision);
    #     """,
    #     reverse_sql="""
    #         ALTER TABLE order_order
    #         ALTER COLUMN end_at TYPE integer USING extract(epoch from end_at)::integer;
    #         ALTER TABLE order_order
    #         ALTER COLUMN plated_end_at TYPE integer USING extract(epoch from plated_end_at)::integer;
    #     """,
    # ),
]

